'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var DataAnalytics=function(){function DataAnalytics(dsid){_classCallCheck(this,DataAnalytics);this.visitTime=new Date().getTime();this.dsid='';this.BASEURL="https://api.prod.myline.skinyiee.com";this.dsid=dsid;}_createClass(DataAnalytics,[{key:'init',value:function init(){this.trackPageView();this.trackScroll();}},{key:'trackBrowserType',value:function trackBrowserType(){return this.detectBrowser();}},{key:'trackDeviceType',value:function trackDeviceType(){return this.detectDeviceType();}},{key:'trackOperatingSystem',value:function trackOperatingSystem(){return this.determineOS();}},{key:'trackScreenResolution',value:function trackScreenResolution(){return screen.width+'x'+screen.height;}},{key:'trackPageView',value:function trackPageView(){var data={status:1,event_name:'view',duration:0,screen_resolution:screen.width+'x'+screen.height,domain:window.location.host,dsid:this.dsid};data.device=this.detectDeviceType();data.browser_type=this.detectBrowser();data.operating_system=this.determineOS();axios.post(this.BASEURL+'/data/view',data).then(function(res){}).catch(function(error){console.log(error);});}},{key:'trackClicks',value:function trackClicks(){var data={status:1,event_name:'line',duration:new Date().getTime()-this.visitTime,screen_resolution:screen.width+'x'+screen.height,domain:window.location.host,dsid:this.dsid};data.device=this.detectDeviceType();data.browser_type=this.detectBrowser();data.operating_system=this.determineOS();axios.post(this.BASEURL+'/data/view',data).then(function(res){}).catch(function(error){console.log(error);});}},{key:'throttle',value:function throttle(fn,delay){var lastCall=0;return function(){var now=new Date().getTime();if(now-lastCall<delay)return;lastCall=now;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}fn.apply(this,args);};}},{key:'axiosScroll',value:function axiosScroll(){var data={status:1,event_name:'scroll',screen_resolution:screen.width+'x'+screen.height,domain:window.location.host,dsid:this.dsid};data.device=this.detectDeviceType();data.browser_type=this.detectBrowser();data.operating_system=this.determineOS();data.duration=new Date().getTime()-this.visitTime;axios.post(this.BASEURL+'/data/view',data).then(function(res){}).catch(function(error){console.log(error);});}},{key:'trackScroll',value:function trackScroll(){var _this=this;var throttledAxiosScroll=this.throttle(this.axiosScroll.bind(this),60000);window.addEventListener('scroll',function(){if(_this.isBottom()){throttledAxiosScroll();}});}},{key:'trackGetUrlParams',value:function trackGetUrlParams(){var currentUrl=window.location.href;var url=new URL(currentUrl);var params=new URLSearchParams(url.search);var paramsObject={};params.forEach(function(value,key){paramsObject[key]=value;});}},{key:'trackBeforeunload',value:function trackBeforeunload(){window.addEventListener('popstate',function(e){console.log('popstate==',e);});window.addEventListener('unload',function(event){console.log('unload==',event);});window.addEventListener('pagehide',function(event){console.log('pagehide==',event);});window.addEventListener('hashchange',function(e){console.log('hashchange==',e);});window.addEventListener('beforeunload',function(e){e.preventDefault();e.returnValue='';console.log('beforeunload==',e);});}},{key:'getConsoleText',value:function getConsoleText(){var originalConsoleLog=console.log;var logOutput=[];console.log=function(){var message=Array.prototype.slice.call(arguments).join(' ');logOutput.push(message);originalConsoleLog.apply(console,arguments);};return logOutput;}},{key:'isBottom',value:function isBottom(){var scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;var scrollHeight=document.documentElement.scrollHeight||document.body.scrollHeight;var clientHeight=document.documentElement.clientHeight||window.innerHeight;return scrollTop+clientHeight>=scrollHeight;}},{key:'detectBrowser',value:function detectBrowser(){var userAgent=navigator.userAgent;if(userAgent.match(/chrome|chromium|crios/i)){return"Chrome";}else if(userAgent.match(/edg/i)){return"Edge";}else if(userAgent.match(/firefox|fxios/i)){return"Firefox";}else if(userAgent.match(/safari/i)){return"Safari";}else if(userAgent.match(/opr|opera/i)){return"Opera";}else{return"Unknown";}}},{key:'detectDeviceType',value:function detectDeviceType(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(/android/i.test(userAgent)){return"Android Device";}if(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream){return"iOS Device";}if(/Windows Phone/i.test(userAgent)){return"Windows Phone";}return"PC";}},{key:'determineOS',value:function determineOS(){var userAgent=navigator.userAgent;if(userAgent.indexOf("Win")!==-1)return"Windows";if(userAgent.indexOf("Mac")!==-1)return"MacOS";if(userAgent.indexOf("X11")!==-1)return"UNIX";if(userAgent.indexOf("Linux")!==-1)return"Linux";return"Unknown OS";}}]);return DataAnalytics;}();